---
title: Installing Redpanda on Kubernetes
---

<head>
    <meta name="title" content="Installing Redpanda on Kubernetes | Redpanda Docs"/>
    <meta name="description" content="Kubernetes quickstart guide."/>
</head>

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

This guide helps you get started with Redpanda for development and testing on Kubernetes. 

:::note
This page uses the latest recommended Helm chart for installing Redpanda. For information about installing Redpanda on Kubernetes using the older Redpanda Operator, see [Redpanda Operator](../../reference/redpanda-operator).
:::

## Prerequisites

Verify that you have the following software installed:

* [kubectl](https://kubernetes.io/docs/tasks/tools/) - version 1.21 or later (the EKS route below requires Kubernetes version 1.22)
* [Helm](https://helm.sh/docs/intro/install/) - version 3.6 or later (the EKS route below requires the [latest 3.8 version](https://github.com/helm/helm/releases/tag/v3.8.2))
* [Go](https://go.dev/doc/install) - v1.17 or later (only required for Windows setup)

## Create a Kubernetes cluster

<Tabs>
  <TabItem value="kind" label="kind" default>

Create the kind config file to create a multi-node cluster:

```bash
cat <<EOF >kind.yaml
---
apiVersion: kind.x-k8s.io/v1alpha4
kind: Cluster
nodes:
  - role: control-plane
  - role: worker
  - role: worker
  - role: worker
EOF
```

Create a Kubernetes cluster:

```bash
kind create cluster --config kind.yaml
```

  </TabItem>
  <TabItem value="minikube" label="minikube">

Create a Kubernetes cluster:

```bash
minikube start --nodes 4
```

Prevent applications from being scheduled with the Kubernetes control plane:

```bash
kubectl taint node \
    -l node-role.kubernetes.io/control-plane="" \
    node-role.kubernetes.io/control-plane=:NoSchedule
```

  </TabItem>
  <TabItem value="eks" label="Amazon EKS">

You need two additional CLIs to create a Kubernetes cluster in AWS:
1. [AWS CLI v2](https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html)
2. [eksctl <= v0.114.0](https://github.com/weaveworks/eksctl/releases/tag/v0.114.0). Install details available  [here](https://docs.aws.amazon.com/eks/latest/userguide/eksctl.html)

You must ensure that appropriate IAM permissions are granted to the user who will be running the following commands. More details can be found [here](https://docs.aws.amazon.com/eks/latest/userguide/security_iam_id-based-policy-examples.html).

Create an Elastic Kubernetes Service (EKS) cluster. The cluster will be created in your default region (see `~/.aws/config`):

```bash
eksctl create cluster --name redpanda \
    --nodegroup-name standard-workers \
    --node-type m5.xlarge \
    --nodes 3 \
    --nodes-min 3 \
    --nodes-max 4
```

After the cluster is created, be sure to update your local kubeconfig to point to this cluster:

```bash
aws eks update-kubeconfig --region us-east-2  --name redpanda
```

Replace the region `us-east-2` in the command above with your default region.
  </TabItem>
  <TabItem value="gke" label="Google GKE">

Create a Google Kubernetes Engine (GKE) cluster:

```bash
gcloud container clusters create redpanda --machine-type n1-standard-4 --num-nodes=3
```

  </TabItem>
</Tabs>

## Use Helm to install Redpanda

Install Redpanda using Helm:

```bash
helm repo add redpanda https://charts.redpanda.com/
helm repo update
helm install redpanda redpanda/redpanda \
    --namespace redpanda \
    --create-namespace
```

The installation produces some notes with getting started tips:

```text
NAME: redpanda
LAST DEPLOYED: Wed Sep 14 17:08:43 2022
NAMESPACE: redpanda
STATUS: deployed
REVISION: 1
NOTES:
Congratulations on installing redpanda!

The pods roll out in a few seconds. To check the status, run:

  kubectl -n redpanda rollout status statefulset redpanda --watch

Try some sample commands, like creating a topic called test-topic:

Get the API status:

  kubectl -n redpanda exec -ti redpanda-0 -c redpanda -- rpk --brokers=redpanda-0.redpanda.redpanda.svc.cluster.local.:9093 cluster info

Create a topic:

  kubectl -n redpanda exec -ti redpanda-0 -c redpanda -- rpk --brokers=redpanda-0.redpanda.redpanda.svc.cluster.local.:9093 topic create test-topic

Describe the topic:

  kubectl -n redpanda exec -ti redpanda-0 -c redpanda -- rpk --brokers=redpanda-0.redpanda.redpanda.svc.cluster.local.:9093 topic describe test-topic

Delete the topic:

  kubectl -n redpanda exec -ti redpanda-0 -c redpanda -- rpk --brokers=redpanda-0.redpanda.redpanda.svc.cluster.local.:9093 topic delete test-topic
```

Wait for the Redpanda cluster to be ready:

```bash
kubectl -n redpanda rollout status statefulset redpanda --watch
```

When it's ready, the output should look similar to the following:

```text
statefulset rolling update complete 3 pods at revision redpanda-8654f645b4...
```

## External access

External access is made available by a NodePort service. Run the following command for details:

```bash
kubectl get service redpanda-external -n redpanda
```
```text
NAME                TYPE       CLUSTER-IP      EXTERNAL-IP   PORT(S)                                                       AGE
redpanda-external   NodePort   10.100.15.142   <none>        9644:31644/TCP,9094:31092/TCP,8083:30082/TCP,8080:30081/TCP   22m
```

The following ports are opened by default:

| Node port | Pod port | Purpose |
|---|---|---|
| 30081 | 8080 | Schema registry |
| 30082 | 8083 | HTTP proxy |
| 31092 | 9094 | Kafka API |
| 31644 | 9644 | Admin API |

You can modify these ports in `values.yaml`. If you do so, then make sure to use the same ports in the steps below.

### Modify inbound security

Cloud-based Kubernetes clusters will have a security group tied to each node in the cluster. For instance, in EKS a security group is applied to each EC2 node.

You must add inbound rules allowing traffic to reach each port above on all nodes that are part of the cluster to enable external access. How these rules are added depends on your Kubernetes environment and cloud provider.

### Update external access

By default the cluster is available externally at `redpanda-<replica index>.<redpanda.external.domain>`. The default values would make this address `redpanda-0.local`. But no external DNS provider is updated to make this address resolvable by default. There are a few ways to resolve this:

1. Use IP address resolution
2. Make `redpanda-0.local` resolvable to the external address of the related Kubernetes node
3. Customize the subdomain and/or domain to point to something resolvable via DNS

Since options 2 and 3 require an external DNS provider, this guide focuses on option 1.

Each Kubernetes node has an external IP address, and they can be found with the following command:

```bash
kubectl get nodes -o wide
```
```text
NAME                                           STATUS   ROLES    AGE   VERSION                INTERNAL-IP      EXTERNAL-IP     OS-IMAGE         KERNEL-VERSION                 CONTAINER-RUNTIME
ip-192-168-31-253.us-east-2.compute.internal   Ready    <none>   24m   v1.22.15-eks-fb459a0   192.168.31.253   203.0.113.3     Amazon Linux 2   5.4.219-126.411.amzn2.x86_64   docker://20.10.17
ip-192-168-41-207.us-east-2.compute.internal   Ready    <none>   24m   v1.22.15-eks-fb459a0   192.168.41.207   203.0.113.5     Amazon Linux 2   5.4.219-126.411.amzn2.x86_64   docker://20.10.17
ip-192-168-90-157.us-east-2.compute.internal   Ready    <none>   24m   v1.22.15-eks-fb459a0   192.168.90.157   203.0.113.7     Amazon Linux 2   5.4.219-126.411.amzn2.x86_64   docker://20.10.17
```

The above example shows there are three nodes with the external IP addresses `3.129.52.203`, `3.12.164.46`, and `3.144.145.170`. You will need to associate each Kubernetes node to the appropriate Redpanda node. In order to do this you also need output from the following command:

```bash
kubectl get pods -o wide -n redpanda
```
```text
NAME                          READY   STATUS      RESTARTS   AGE    IP               NODE                                           NOMINATED NODE   READINESS GATES
redpanda-0                    1/1     Running     0          109m   192.168.30.134   ip-192-168-31-253.us-east-2.compute.internal   <none>           <none>
redpanda-1                    1/1     Running     0          109m   192.168.60.112   ip-192-168-41-207.us-east-2.compute.internal   <none>           <none>
redpanda-2                    1/1     Running     0          110m   192.168.68.55    ip-192-168-90-157.us-east-2.compute.internal   <none>           <none>
redpanda-post-install-skkl7   0/1     Completed   0          110m   192.168.73.172   ip-192-168-90-157.us-east-2.compute.internal   <none>           <none>
redpanda-post-upgrade-r85f6   0/1     Completed   0          110m   192.168.33.87    ip-192-168-41-207.us-east-2.compute.internal   <none>           <none>
```

The above example shows `redpanda-0` running on a node with the name `ip-192-168-31-253.us-east-2.compute.internal`, giving us the internal IP address of `192.168.31.253`. Using this combined with the output from the previous command, you get the following associations:

| Redpanda node | External IP |
|---|---|
| redpanda-0 | 203.0.113.3 |
| redpanda-1 | 203.0.113.5 |
| redpanda-2 | 203.0.113.7 |

:::note
The Kubernetes node order and Redpanda node order were the same in the above example, but this will not always be the case.
:::


Now update `values.yaml` with the external IPs, making sure to match the Redpanda node order:

```yaml
redpanda:
  external:
    addressType: ip
    addresses: "203.0.113.3 203.0.113.5 203.0.113.7"
```

Apply these updates using the following helm command:

```bash
helm upgrade redpanda redpanda/redpanda -n redpanda
```

### Verify external access

You should now be able to connect to your cluster from an external client. The steps below show how to connect a locally-installed `rpk` client to your cluster. Details on how to install `rpk` are [here](https://docs.redpanda.com/docs/platform/quickstart/rpk-install/)).

Set the `REDPANDA_BROKERS` environment variable using the external IP addresses from above:

```bash
export REDPANDA_BROKERS=203.0.113.3:31092,203.0.113.5:31092,203.0.113.7:31092
```

Get the cluster info:

```bash
rpk cluster info
```
```text
CLUSTER
=======
redpanda.ad4a2f55-f34e-4a7f-babd-01d392cf4e80

BROKERS
=======
ID    HOST           PORT
0     203.0.113.3    31092
1*    203.0.113.5    31092
2     203.0.113.7    31092
```
